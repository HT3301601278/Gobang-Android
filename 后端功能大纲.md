# 五子棋后端功能大纲

### 1. 用户系统
- **账号管理**
  - 用户注册：支持用户名、邮箱、密码和昵称字段的注册
  - 用户登录：基于用户名和密码的登录机制
  - 用户登出：支持用户安全退出系统
  - 状态跟踪：实时记录和更新用户在线状态
- **安全认证**
  - JWT身份认证：使用JSON Web Token实现用户身份验证
  - 密码管理：支持密码存储和验证
- **账号恢复**
  - 邮箱验证码：支持通过邮箱验证码进行身份验证
  - 找回密码：基于邮箱验证码的密码找回功能
  - 修改密码：已登录用户可修改密码
  - 验证码系统：10分钟有效期的验证码，包含TTL自动过期机制
- **个人资料**
  - 用户资料查看：查看自己的详细资料
  - 资料编辑：支持修改昵称等个人信息
  - 头像管理：支持默认头像、系统头像和自定义上传头像
  - 其他用户资料查看：查看其他用户的公开资料
- **数据统计**
  - 对局数据：记录总游戏数、胜利次数、失败次数和平局次数
  - 胜率计算：基于游戏记录自动统计和更新
  - 历史记录：保存用户对战历史

### 2. 好友系统
- **好友管理**
  - 添加好友：发送好友请求
  - 接受好友：处理接收到的好友请求
  - 拒绝好友：拒绝好友请求
  - 删除好友：移除现有好友关系
- **好友互动**
  - 好友列表：查看所有好友及其状态
  - 好友请求列表：查看待处理的好友请求
  - 好友状态监控：实时显示好友在线状态和游戏状态
  - 好友资料查看：查看好友的个人资料
- **搜索功能**
  - 用户搜索：通过用户名或昵称搜索用户
  - 搜索结果过滤：区分好友、非好友和已发送请求用户
- **请求管理**
  - 请求通知：实时接收新好友请求通知
  - 请求状态跟踪：追踪请求状态（待处理/已接受）
  - 请求时间记录：记录请求发送和处理时间

### 3. 房间管理
- **房间操作**
  - 创建房间：用户可创建游戏房间
  - 加入房间：通过房间ID加入现有房间
  - 离开房间：玩家可随时离开房间
  - 解散房间：房主可解散房间
  - 房间列表：浏览可加入的开放房间
- **房间设置**
  - 房间状态：跟踪房间状态（等待/游戏中/游戏结束）
  - 游戏设置：棋盘大小、时间限制、悔棋设置等
  - 语音设置：启用/禁用语音、自动加入语音、噪声消除等
  - 房主权限：房主专属设置修改权限
- **玩家交互**
  - 好友邀请：向好友发送房间邀请
  - 玩家状态：显示房间内玩家状态
  - 断线重连：支持玩家断线重新加入房间
  - 玩家角色：区分房主和客人角色
- **房间状态**
  - 连接状态监控：跟踪玩家连接/断开状态
  - 断线时间记录：记录玩家断线时间
  - 房间持久化：保存房间信息和历史游戏记录

### 4. 游戏对战
- **核心玩法**
  - 标准五子棋规则：实现完整的五子棋游戏逻辑
  - 回合制落子：黑白双方交替落子
  - 胜负判定：自动检测五子连珠并判定胜负
  - 实时同步：所有玩家实时看到棋盘状态变化
- **游戏功能**
  - 悔棋机制：支持玩家请求撤回上一步棋
  - 和棋功能：支持双方协商和棋
  - 认输功能：允许玩家主动认输
  - 计时系统：步时限制和总时限制
  - 超时判负：超过时间限制自动判负
- **游戏进程**
  - 棋盘重建：支持断线重连后恢复棋盘状态
  - 移动记录：记录每一步棋的位置和时间
  - 悔棋历史：记录悔棋请求和处理
  - 游戏重开：在同一房间开始新游戏
- **通信功能**
  - 游戏内聊天：支持文字聊天功能
  - 快捷短语：预设和自定义快捷短语
  - 表情系统：支持发送表情
  - 语音聊天：实时语音通信功能

### 5. 实时通信
- **Socket.IO集成**
  - 实时事件：所有游戏和社交事件实时推送
  - 房间通信：基于房间的消息广播
  - 私人通信：用户间私人消息传递
- **语音聊天**
  - 语音房间：基于游戏房间的语音通道
  - 麦克风控制：静音/取消静音功能
  - 参与者管理：显示语音聊天参与者列表
  - 语音设置：房主可配置语音聊天参数
- **连接管理**
  - 断线检测：自动检测用户断线
  - 重连机制：支持用户断线后重新连接
  - 会话恢复：恢复断线前的游戏和社交状态
  - 异常处理：处理各种连接异常情况
