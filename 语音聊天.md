# 语音聊天

## Socket.io 事件

### 客户端发送事件

#### 1. 加入语音聊天
- **事件名称**: `voice:join`
- **参数**:
  ```json
  {
    "roomId": "房间ID"
  }
  ```
- **回调响应**:
  ```json
  {
    "success": true,
    "message": "成功加入语音聊天",
    "participants": [
      {
        "userId": "用户ID",
        "nickname": "用户昵称",
        "muted": false,
        "joinedAt": "加入时间"
      }
    ]
  }
  ```

#### 2. 离开语音聊天
- **事件名称**: `voice:leave`
- **参数**:
  ```json
  {
    "roomId": "房间ID"
  }
  ```
- **回调响应**:
  ```json
  {
    "success": true,
    "message": "成功离开语音聊天"
  }
  ```

#### 3. 切换麦克风状态
- **事件名称**: `voice:toggle_mute`
- **参数**:
  ```json
  {
    "roomId": "房间ID",
    "muted": true/false
  }
  ```
- **回调响应**:
  ```json
  {
    "success": true,
    "message": "已静音/已取消静音"
  }
  ```

#### 4. 更新房间语音设置
- **事件名称**: `voice:update_settings`
- **参数**:
  ```json
  {
    "roomId": "房间ID",
    "settings": {
      "enabled": true/false,
      "其他语音设置选项..."
    }
  }
  ```
- **回调响应**:
  ```json
  {
    "success": true,
    "message": "语音设置已更新"
  }
  ```

#### 5. 获取房间语音状态
- **事件名称**: `voice:get_status`
- **参数**:
  ```json
  {
    "roomId": "房间ID"
  }
  ```
- **回调响应**:
  ```json
  {
    "success": true,
    "settings": {
      "enabled": true/false,
      "其他语音设置..."
    },
    "status": {
      "isActive": true/false,
      "participants": [
        {
          "userId": "用户ID",
          "nickname": "用户昵称",
          "muted": false,
          "joinedAt": "加入时间"
        }
      ],
      "isParticipating": true/false
    }
  }
  ```

#### 6. 发送语音数据
- **事件名称**: `voice:data`
- **参数**:
  ```json
  {
    "roomId": "房间ID",
    "audioData": "音频数据"
  }
  ```

### 客户端接收事件

#### 1. 用户加入语音通知
- **事件名称**: `voice:user_joined`
- **数据格式**:
  ```json
  {
    "userId": "加入用户ID",
    "nickname": "加入用户昵称",
    "participants": [
      {
        "userId": "用户ID",
        "nickname": "用户昵称",
        "muted": false,
        "joinedAt": "加入时间"
      }
    ]
  }
  ```

#### 2. 用户离开语音通知
- **事件名称**: `voice:user_left`
- **数据格式**:
  ```json
  {
    "userId": "离开用户ID",
    "participants": [
      {
        "userId": "用户ID",
        "nickname": "用户昵称",
        "muted": false,
        "joinedAt": "加入时间"
      }
    ]
  }
  ```

#### 3. 麦克风状态变更通知
- **事件名称**: `voice:mute_changed`
- **数据格式**:
  ```json
  {
    "userId": "用户ID",
    "muted": true/false
  }
  ```

#### 4. 语音聊天被禁用通知
- **事件名称**: `voice:disabled`
- **数据格式**:
  ```json
  {
    "roomId": "房间ID",
    "message": "房主已禁用语音聊天"
  }
  ```

#### 5. 语音设置更新通知
- **事件名称**: `voice:settings_updated`
- **数据格式**:
  ```json
  {
    "roomId": "房间ID",
    "settings": {
      "enabled": true/false,
      "其他语音设置..."
    }
  }
  ```

#### 6. 接收语音数据
- **事件名称**: `voice:data`
- **数据格式**:
  ```json
  {
    "userId": "发送者用户ID",
    "audioData": "音频数据",
    "timestamp": 1628763452000
  }
  ```
