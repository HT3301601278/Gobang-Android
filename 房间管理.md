# 房间管理

## RESTful API 接口

### 1. 获取用户所在的房间

- **请求方式**: GET
- **接口地址**: `/rooms/my`
- **请求头**:
  ```
  Authorization: Bearer {token}
  ```
- **响应**:
  ```json
  {
    "success": true,
    "rooms": [
      {
        "roomId": "房间ID",
        "status": "房间状态",
        "role": "host/guest",
        "opponent": {
          "userId": "对手ID",
          "nickname": "对手昵称",
          "avatar": "对手头像URL",
          "disconnected": true/false
        },
        "gameSettings": {
          "boardSize": 15,
          "timeLimit": 30,
          "totalTimeLimit": 600,
          "allowUndo": true,
          "maxUndoCount": 3
        },
        "disconnected": true/false,
        "disconnectedAt": "断开连接时间",
        "currentGameId": "当前游戏ID",
        "createdAt": "创建时间",
        "updatedAt": "更新时间"
      }
    ]
  }
  ```

## Socket.io 事件

### 客户端发送事件

#### 1. 创建房间
- **事件名称**: `room:create`
- **参数**:
  ```json
  {
    "gameSettings": {
      "boardSize": 15,
      "timeLimit": 30,
      "totalTimeLimit": 600,
      "allowUndo": true,
      "maxUndoCount": 3
    }
  }
  ```
- **回调响应**:
  ```json
  {
    "success": true,
    "room": {
      "roomId": "房间ID",
      "host": {
        "userId": "用户ID",
        "nickname": "用户昵称",
        "avatar": "头像URL"
      },
      "gameSettings": {
        "boardSize": 15,
        "timeLimit": 30,
        "totalTimeLimit": 600,
        "allowUndo": true,
        "maxUndoCount": 3
      }
    }
  }
  ```

#### 2. 加入房间
- **事件名称**: `room:join`
- **参数**:
  ```json
  {
    "roomId": "房间ID"
  }
  ```
- **回调响应**:
  ```json
  {
    "success": true,
    "room": {
      "roomId": "房间ID",
      "hostId": "房主ID",
      "host": {
        "userId": "房主ID",
        "nickname": "房主昵称",
        "avatar": "房主头像URL"
      },
      "status": "房间状态",
      "gameSettings": {
        "boardSize": 15,
        "timeLimit": 30,
        "totalTimeLimit": 600,
        "allowUndo": true,
        "maxUndoCount": 3
      }
    },
    "players": [
      {
        "userId": "用户ID",
        "nickname": "用户昵称",
        "avatar": "头像URL",
        "role": "host/guest"
      }
    ]
  }
  ```

#### 3. 离开房间
- **事件名称**: `room:leave`
- **参数**:
  ```json
  {
    "roomId": "房间ID"
  }
  ```
- **回调响应**:
  ```json
  {
    "success": true,
    "message": "已离开房间"
  }
  ```

#### 4. 邀请好友加入房间
- **事件名称**: `room:invite`
- **参数**:
  ```json
  {
    "roomId": "房间ID",
    "friendId": "好友用户ID"
  }
  ```
- **回调响应**:
  ```json
  {
    "success": true,
    "message": "邀请已发送"
  }
  ```

#### 5. 响应房间邀请
- **事件名称**: `room:invite_response`
- **参数**:
  ```json
  {
    "roomId": "房间ID",
    "accept": true/false
  }
  ```
- **回调响应**:
  ```json
  {
    "success": true,
    "message": "已接受/拒绝邀请",
    "room": {
      "roomId": "房间ID",
      "hostId": "房主ID",
      "host": {
        "userId": "房主ID",
        "nickname": "房主昵称",
        "avatar": "房主头像URL"
      },
      "status": "房间状态"
    },
    "players": [
      {
        "userId": "用户ID",
        "nickname": "用户昵称",
        "avatar": "头像URL",
        "role": "host/guest"
      }
    ]
  }
  ```

### 客户端接收事件

#### 1. 玩家加入房间
- **事件名称**: `room:player_joined`
- **数据格式**:
  ```json
  {
    "player": {
      "userId": "用户ID",
      "nickname": "用户昵称",
      "avatar": "头像URL",
      "role": "host/guest"
    }
  }
  ```

#### 2. 玩家离开房间
- **事件名称**: `room:player_left`
- **数据格式**:
  ```json
  {
    "playerId": "用户ID",
    "message": "离开原因说明"
  }
  ```

#### 3. 房主变更
- **事件名称**: `room:host_changed`
- **数据格式**:
  ```json
  {
    "newHostId": "新房主ID",
    "newHostNickname": "新房主昵称",
    "message": "房主变更原因"
  }
  ```

#### 4. 收到房间邀请
- **事件名称**: `room:invite_received`
- **数据格式**:
  ```json
  {
    "roomId": "房间ID",
    "inviter": {
      "userId": "邀请者ID",
      "nickname": "邀请者昵称",
      "avatar": "邀请者头像URL"
    }
  }
  ```

#### 5. 邀请被接受
- **事件名称**: `room:invite_accepted`
- **数据格式**:
  ```json
  {
    "userId": "接受邀请的用户ID",
    "nickname": "接受邀请的用户昵称"
  }
  ```

#### 6. 邀请被拒绝
- **事件名称**: `room:invite_rejected`
- **数据格式**:
  ```json
  {
    "userId": "拒绝邀请的用户ID"
  }
  ```

#### 7. 房主断开连接
- **事件名称**: `room:host_disconnected`
- **数据格式**:
  ```json
  {
    "message": "房主已断开连接，等待重新连接..."
  }
  ```

#### 8. 客人断开连接
- **事件名称**: `room:guest_disconnected`
- **数据格式**:
  ```json
  {
    "playerId": "断开连接的用户ID",
    "message": "客人已断开连接，等待重新连接..."
  }
  ```

#### 9. 房主重新连接
- **事件名称**: `room:host_reconnected`
- **数据格式**:
  ```json
  {
    "message": "房主已重新连接"
  }
  ```

#### 10. 客人重新连接
- **事件名称**: `room:guest_reconnected`
- **数据格式**:
  ```json
  {
    "userId": "重新连接的用户ID",
    "message": "客人已重新连接"
  }
  ```
